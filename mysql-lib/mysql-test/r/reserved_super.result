GRANT USAGE ON *.* TO mysqltest_u1@localhost;

SET GLOBAL max_connections = 4;
SET GLOBAL reserved_super_connections = 2;

# -- Disconnecting default connection...

# -- Check that we allow exactly 2 non-SUPER connections

# -- Connecting (1)...
# -- Establishing connection 'con_1' (user: mysqltest_u1)...
# -- Connection 'con_1' has been established.

# -- Connecting (2)...
# -- Establishing connection 'con_2' (user: mysqltest_u1)...
# -- Connection 'con_2' has been established.

# -- Connecting (3) [should fail]...
# -- Establishing connection 'con_3' (user: mysqltest_u1)...
# -- Error: can not establish connection 'con_3'.

# -- Check that there are still two SUPER-user connections available.

# -- Connecting super (1)...
# -- Establishing connection 'con_super_1' (user: root)...
# -- Connection 'con_super_1' has been established.

# -- Connecting super (2)...
# -- Establishing connection 'con_super_2' (user: root)...
# -- Connection 'con_super_2' has been established.

# -- Check that we allow one extra SUPER-user connection above
# -- max_connections.

# -- Connecting super (3)...
# -- Establishing connection 'con_super_3' (user: root)...
# -- Connection 'con_super_3' has been established.

# -- Further connections should be denied, even for SUPER.

# -- Connecting super (4) [should fail]...
# -- Establishing connection 'con_super_4' (user: root)...
# -- Error: can not establish connection 'con_super_4'.

# -- Resetting variables...
SET GLOBAL max_connections = 151;
SET GLOBAL reserved_super_connections = 10;

# -- That's it. Closing connections...

# -- Restoring default connection...

# -- Waiting for connections to close...

DROP USER mysqltest_u1@localhost;
