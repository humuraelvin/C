GRANT USAGE ON *.* TO mysqltest_u1@localhost;
insert into mysql.system_user
(User, Host, Password, Select_priv, Insert_priv, Update_priv, Delete_priv,
ssl_cipher, x509_issuer, x509_subject, authentication_string)
values ('system_user1', 'localhost', '', 'Y', 'Y', 'Y', 'Y', '', '', '', '');
flush privileges;

SET GLOBAL max_connections = 4;
SET GLOBAL reserved_super_connections = 2;

# -- Disconnecting default connection...

# -- Check that we allow exactly 2 non-SUPER connections

# -- Connecting (1)...
# -- Establishing connection 'con_1' (user: mysqltest_u1)...
# -- Connection 'con_1' has been established.

# -- Connecting (2)...
# -- Establishing connection 'con_2' (user: mysqltest_u1)...
# -- Connection 'con_2' has been established.

# -- Connecting (3) [should fail]...
# -- Establishing connection 'con_3' (user: mysqltest_u1)...
# -- Error: can not establish connection 'con_3'.

# -- Check that there are still two SYSTEM-user connections available.

# -- Connecting system (1)...
# -- Establishing connection 'con_system_1' (user: system_user1)...
# -- Connection 'con_system_1' has been established.

# -- Connecting system (2)...
# -- Establishing connection 'con_system_2' (user: system_user1)...
# -- Connection 'con_system_2' has been established.

# -- Check that we allow one extra SYSTEM-user connection above
# -- max_connections.

# -- Connecting system (3)...
# -- Establishing connection 'con_system_3' (user: system_user1)...
# -- Connection 'con_system_3' has been established.

# -- Further connections should be denied, even for SYSTEM or SUPER.

# -- Connecting system (4) [should fail]...
# -- Establishing connection 'con_system_4' (user: system_user1)...
# -- Error: can not establish connection 'con_system_4'.

# -- Connecting super (4) [should fail]...
# -- Establishing connection 'con_super_4' (user: root)...
# -- Error: can not establish connection 'con_super_4'.

# -- That's it. Closing connections...

# -- Restoring default connection...

# -- Resetting variables...

# -- Waiting for connections to close...

DROP USER mysqltest_u1@localhost;
