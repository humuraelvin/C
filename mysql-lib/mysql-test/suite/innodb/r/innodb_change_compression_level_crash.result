#
# Testing crash recovery when log_compressed_pages=OFF and compression level is changed dynamically.
#
# Don't test this under valgrind, memory leaks will occur
# Binary must be compiled with debug for crash to occur
DROP TABLE IF EXISTS t1;
SET GLOBAL INNODB_FILE_FORMAT = 'Barracuda';
call mtr.add_suppression(".*");
CREATE TABLE t1(id INT PRIMARY KEY, msg VARCHAR(255))
ENGINE=INNODB
ROW_FORMAT=COMPRESSED
KEY_BLOCK_SIZE=1;
create procedure setcrash(IN i INT)
begin
CASE i
WHEN 1 THEN SET SESSION debug_dbug="d,crash_commit_before";
ELSE BEGIN END;
END CASE;
end //
SET GLOBAL innodb_compression_level = 9;
SET GLOBAL innodb_log_compressed_pages = OFF;
START TRANSACTION;
INSERT INTO t1(id, msg)
VALUES (1, REPEAT(PASSWORD(30), 5));
INSERT INTO t1(id, msg)
VALUES (2, REPEAT(PASSWORD(29), 5));
INSERT INTO t1(id, msg)
VALUES (3, REPEAT(PASSWORD(28), 5));
INSERT INTO t1(id, msg)
VALUES (4, REPEAT(PASSWORD(27), 5));
INSERT INTO t1(id, msg)
VALUES (5, REPEAT(PASSWORD(26), 5));
INSERT INTO t1(id, msg)
VALUES (6, REPEAT(PASSWORD(25), 5));
INSERT INTO t1(id, msg)
VALUES (7, REPEAT(PASSWORD(24), 5));
INSERT INTO t1(id, msg)
VALUES (8, REPEAT(PASSWORD(23), 5));
INSERT INTO t1(id, msg)
VALUES (9, REPEAT(PASSWORD(22), 5));
INSERT INTO t1(id, msg)
VALUES (10, REPEAT(PASSWORD(21), 5));
INSERT INTO t1(id, msg)
VALUES (11, REPEAT(PASSWORD(20), 5));
INSERT INTO t1(id, msg)
VALUES (12, REPEAT(PASSWORD(19), 5));
INSERT INTO t1(id, msg)
VALUES (13, REPEAT(PASSWORD(18), 5));
INSERT INTO t1(id, msg)
VALUES (14, REPEAT(PASSWORD(17), 5));
INSERT INTO t1(id, msg)
VALUES (15, REPEAT(PASSWORD(16), 5));
INSERT INTO t1(id, msg)
VALUES (16, REPEAT(PASSWORD(15), 5));
INSERT INTO t1(id, msg)
VALUES (17, REPEAT(PASSWORD(14), 5));
INSERT INTO t1(id, msg)
VALUES (18, REPEAT(PASSWORD(13), 5));
INSERT INTO t1(id, msg)
VALUES (19, REPEAT(PASSWORD(12), 5));
INSERT INTO t1(id, msg)
VALUES (20, REPEAT(PASSWORD(11), 5));
INSERT INTO t1(id, msg)
VALUES (21, REPEAT(PASSWORD(10), 5));
INSERT INTO t1(id, msg)
VALUES (22, REPEAT(PASSWORD(9), 5));
INSERT INTO t1(id, msg)
VALUES (23, REPEAT(PASSWORD(8), 5));
INSERT INTO t1(id, msg)
VALUES (24, REPEAT(PASSWORD(7), 5));
INSERT INTO t1(id, msg)
VALUES (25, REPEAT(PASSWORD(6), 5));
INSERT INTO t1(id, msg)
VALUES (26, REPEAT(PASSWORD(5), 5));
INSERT INTO t1(id, msg)
VALUES (27, REPEAT(PASSWORD(4), 5));
INSERT INTO t1(id, msg)
VALUES (28, REPEAT(PASSWORD(3), 5));
INSERT INTO t1(id, msg)
VALUES (29, REPEAT(PASSWORD(2), 5));
INSERT INTO t1(id, msg)
VALUES (30, REPEAT(PASSWORD(1), 5));
# Write file to make mysql-test-run.pl expect crash
call setcrash(1);
# Run the crashing query
COMMIT;
# Turn on reconnect
# Call script that will poll the server waiting for
# it to be back online again
SET GLOBAL innodb_compression_level = 8;
SET GLOBAL innodb_log_compressed_pages = OFF;
START TRANSACTION;
INSERT INTO t1(id, msg)
VALUES (31, REPEAT(PASSWORD(30), 5));
INSERT INTO t1(id, msg)
VALUES (32, REPEAT(PASSWORD(29), 5));
INSERT INTO t1(id, msg)
VALUES (33, REPEAT(PASSWORD(28), 5));
INSERT INTO t1(id, msg)
VALUES (34, REPEAT(PASSWORD(27), 5));
INSERT INTO t1(id, msg)
VALUES (35, REPEAT(PASSWORD(26), 5));
INSERT INTO t1(id, msg)
VALUES (36, REPEAT(PASSWORD(25), 5));
INSERT INTO t1(id, msg)
VALUES (37, REPEAT(PASSWORD(24), 5));
INSERT INTO t1(id, msg)
VALUES (38, REPEAT(PASSWORD(23), 5));
INSERT INTO t1(id, msg)
VALUES (39, REPEAT(PASSWORD(22), 5));
INSERT INTO t1(id, msg)
VALUES (40, REPEAT(PASSWORD(21), 5));
INSERT INTO t1(id, msg)
VALUES (41, REPEAT(PASSWORD(20), 5));
INSERT INTO t1(id, msg)
VALUES (42, REPEAT(PASSWORD(19), 5));
INSERT INTO t1(id, msg)
VALUES (43, REPEAT(PASSWORD(18), 5));
INSERT INTO t1(id, msg)
VALUES (44, REPEAT(PASSWORD(17), 5));
INSERT INTO t1(id, msg)
VALUES (45, REPEAT(PASSWORD(16), 5));
INSERT INTO t1(id, msg)
VALUES (46, REPEAT(PASSWORD(15), 5));
INSERT INTO t1(id, msg)
VALUES (47, REPEAT(PASSWORD(14), 5));
INSERT INTO t1(id, msg)
VALUES (48, REPEAT(PASSWORD(13), 5));
INSERT INTO t1(id, msg)
VALUES (49, REPEAT(PASSWORD(12), 5));
INSERT INTO t1(id, msg)
VALUES (50, REPEAT(PASSWORD(11), 5));
INSERT INTO t1(id, msg)
VALUES (51, REPEAT(PASSWORD(10), 5));
INSERT INTO t1(id, msg)
VALUES (52, REPEAT(PASSWORD(9), 5));
INSERT INTO t1(id, msg)
VALUES (53, REPEAT(PASSWORD(8), 5));
INSERT INTO t1(id, msg)
VALUES (54, REPEAT(PASSWORD(7), 5));
INSERT INTO t1(id, msg)
VALUES (55, REPEAT(PASSWORD(6), 5));
INSERT INTO t1(id, msg)
VALUES (56, REPEAT(PASSWORD(5), 5));
INSERT INTO t1(id, msg)
VALUES (57, REPEAT(PASSWORD(4), 5));
INSERT INTO t1(id, msg)
VALUES (58, REPEAT(PASSWORD(3), 5));
INSERT INTO t1(id, msg)
VALUES (59, REPEAT(PASSWORD(2), 5));
INSERT INTO t1(id, msg)
VALUES (60, REPEAT(PASSWORD(1), 5));
# Write file to make mysql-test-run.pl expect crash
call setcrash(1);
# Run the crashing query
COMMIT;
# Turn on reconnect
# Call script that will poll the server waiting for
# it to be back online again
SET GLOBAL innodb_compression_level = 7;
SET GLOBAL innodb_log_compressed_pages = OFF;
START TRANSACTION;
INSERT INTO t1(id, msg)
VALUES (61, REPEAT(PASSWORD(30), 5));
INSERT INTO t1(id, msg)
VALUES (62, REPEAT(PASSWORD(29), 5));
INSERT INTO t1(id, msg)
VALUES (63, REPEAT(PASSWORD(28), 5));
INSERT INTO t1(id, msg)
VALUES (64, REPEAT(PASSWORD(27), 5));
INSERT INTO t1(id, msg)
VALUES (65, REPEAT(PASSWORD(26), 5));
INSERT INTO t1(id, msg)
VALUES (66, REPEAT(PASSWORD(25), 5));
INSERT INTO t1(id, msg)
VALUES (67, REPEAT(PASSWORD(24), 5));
INSERT INTO t1(id, msg)
VALUES (68, REPEAT(PASSWORD(23), 5));
INSERT INTO t1(id, msg)
VALUES (69, REPEAT(PASSWORD(22), 5));
INSERT INTO t1(id, msg)
VALUES (70, REPEAT(PASSWORD(21), 5));
INSERT INTO t1(id, msg)
VALUES (71, REPEAT(PASSWORD(20), 5));
INSERT INTO t1(id, msg)
VALUES (72, REPEAT(PASSWORD(19), 5));
INSERT INTO t1(id, msg)
VALUES (73, REPEAT(PASSWORD(18), 5));
INSERT INTO t1(id, msg)
VALUES (74, REPEAT(PASSWORD(17), 5));
INSERT INTO t1(id, msg)
VALUES (75, REPEAT(PASSWORD(16), 5));
INSERT INTO t1(id, msg)
VALUES (76, REPEAT(PASSWORD(15), 5));
INSERT INTO t1(id, msg)
VALUES (77, REPEAT(PASSWORD(14), 5));
INSERT INTO t1(id, msg)
VALUES (78, REPEAT(PASSWORD(13), 5));
INSERT INTO t1(id, msg)
VALUES (79, REPEAT(PASSWORD(12), 5));
INSERT INTO t1(id, msg)
VALUES (80, REPEAT(PASSWORD(11), 5));
INSERT INTO t1(id, msg)
VALUES (81, REPEAT(PASSWORD(10), 5));
INSERT INTO t1(id, msg)
VALUES (82, REPEAT(PASSWORD(9), 5));
INSERT INTO t1(id, msg)
VALUES (83, REPEAT(PASSWORD(8), 5));
INSERT INTO t1(id, msg)
VALUES (84, REPEAT(PASSWORD(7), 5));
INSERT INTO t1(id, msg)
VALUES (85, REPEAT(PASSWORD(6), 5));
INSERT INTO t1(id, msg)
VALUES (86, REPEAT(PASSWORD(5), 5));
INSERT INTO t1(id, msg)
VALUES (87, REPEAT(PASSWORD(4), 5));
INSERT INTO t1(id, msg)
VALUES (88, REPEAT(PASSWORD(3), 5));
INSERT INTO t1(id, msg)
VALUES (89, REPEAT(PASSWORD(2), 5));
INSERT INTO t1(id, msg)
VALUES (90, REPEAT(PASSWORD(1), 5));
# Write file to make mysql-test-run.pl expect crash
call setcrash(1);
# Run the crashing query
COMMIT;
# Turn on reconnect
# Call script that will poll the server waiting for
# it to be back online again
SET GLOBAL innodb_compression_level = 6;
SET GLOBAL innodb_log_compressed_pages = OFF;
START TRANSACTION;
INSERT INTO t1(id, msg)
VALUES (91, REPEAT(PASSWORD(30), 5));
INSERT INTO t1(id, msg)
VALUES (92, REPEAT(PASSWORD(29), 5));
INSERT INTO t1(id, msg)
VALUES (93, REPEAT(PASSWORD(28), 5));
INSERT INTO t1(id, msg)
VALUES (94, REPEAT(PASSWORD(27), 5));
INSERT INTO t1(id, msg)
VALUES (95, REPEAT(PASSWORD(26), 5));
INSERT INTO t1(id, msg)
VALUES (96, REPEAT(PASSWORD(25), 5));
INSERT INTO t1(id, msg)
VALUES (97, REPEAT(PASSWORD(24), 5));
INSERT INTO t1(id, msg)
VALUES (98, REPEAT(PASSWORD(23), 5));
INSERT INTO t1(id, msg)
VALUES (99, REPEAT(PASSWORD(22), 5));
INSERT INTO t1(id, msg)
VALUES (100, REPEAT(PASSWORD(21), 5));
INSERT INTO t1(id, msg)
VALUES (101, REPEAT(PASSWORD(20), 5));
INSERT INTO t1(id, msg)
VALUES (102, REPEAT(PASSWORD(19), 5));
INSERT INTO t1(id, msg)
VALUES (103, REPEAT(PASSWORD(18), 5));
INSERT INTO t1(id, msg)
VALUES (104, REPEAT(PASSWORD(17), 5));
INSERT INTO t1(id, msg)
VALUES (105, REPEAT(PASSWORD(16), 5));
INSERT INTO t1(id, msg)
VALUES (106, REPEAT(PASSWORD(15), 5));
INSERT INTO t1(id, msg)
VALUES (107, REPEAT(PASSWORD(14), 5));
INSERT INTO t1(id, msg)
VALUES (108, REPEAT(PASSWORD(13), 5));
INSERT INTO t1(id, msg)
VALUES (109, REPEAT(PASSWORD(12), 5));
INSERT INTO t1(id, msg)
VALUES (110, REPEAT(PASSWORD(11), 5));
INSERT INTO t1(id, msg)
VALUES (111, REPEAT(PASSWORD(10), 5));
INSERT INTO t1(id, msg)
VALUES (112, REPEAT(PASSWORD(9), 5));
INSERT INTO t1(id, msg)
VALUES (113, REPEAT(PASSWORD(8), 5));
INSERT INTO t1(id, msg)
VALUES (114, REPEAT(PASSWORD(7), 5));
INSERT INTO t1(id, msg)
VALUES (115, REPEAT(PASSWORD(6), 5));
INSERT INTO t1(id, msg)
VALUES (116, REPEAT(PASSWORD(5), 5));
INSERT INTO t1(id, msg)
VALUES (117, REPEAT(PASSWORD(4), 5));
INSERT INTO t1(id, msg)
VALUES (118, REPEAT(PASSWORD(3), 5));
INSERT INTO t1(id, msg)
VALUES (119, REPEAT(PASSWORD(2), 5));
INSERT INTO t1(id, msg)
VALUES (120, REPEAT(PASSWORD(1), 5));
# Write file to make mysql-test-run.pl expect crash
call setcrash(1);
# Run the crashing query
COMMIT;
# Turn on reconnect
# Call script that will poll the server waiting for
# it to be back online again
SET GLOBAL innodb_compression_level = 5;
SET GLOBAL innodb_log_compressed_pages = OFF;
START TRANSACTION;
INSERT INTO t1(id, msg)
VALUES (121, REPEAT(PASSWORD(30), 5));
INSERT INTO t1(id, msg)
VALUES (122, REPEAT(PASSWORD(29), 5));
INSERT INTO t1(id, msg)
VALUES (123, REPEAT(PASSWORD(28), 5));
INSERT INTO t1(id, msg)
VALUES (124, REPEAT(PASSWORD(27), 5));
INSERT INTO t1(id, msg)
VALUES (125, REPEAT(PASSWORD(26), 5));
INSERT INTO t1(id, msg)
VALUES (126, REPEAT(PASSWORD(25), 5));
INSERT INTO t1(id, msg)
VALUES (127, REPEAT(PASSWORD(24), 5));
INSERT INTO t1(id, msg)
VALUES (128, REPEAT(PASSWORD(23), 5));
INSERT INTO t1(id, msg)
VALUES (129, REPEAT(PASSWORD(22), 5));
INSERT INTO t1(id, msg)
VALUES (130, REPEAT(PASSWORD(21), 5));
INSERT INTO t1(id, msg)
VALUES (131, REPEAT(PASSWORD(20), 5));
INSERT INTO t1(id, msg)
VALUES (132, REPEAT(PASSWORD(19), 5));
INSERT INTO t1(id, msg)
VALUES (133, REPEAT(PASSWORD(18), 5));
INSERT INTO t1(id, msg)
VALUES (134, REPEAT(PASSWORD(17), 5));
INSERT INTO t1(id, msg)
VALUES (135, REPEAT(PASSWORD(16), 5));
INSERT INTO t1(id, msg)
VALUES (136, REPEAT(PASSWORD(15), 5));
INSERT INTO t1(id, msg)
VALUES (137, REPEAT(PASSWORD(14), 5));
INSERT INTO t1(id, msg)
VALUES (138, REPEAT(PASSWORD(13), 5));
INSERT INTO t1(id, msg)
VALUES (139, REPEAT(PASSWORD(12), 5));
INSERT INTO t1(id, msg)
VALUES (140, REPEAT(PASSWORD(11), 5));
INSERT INTO t1(id, msg)
VALUES (141, REPEAT(PASSWORD(10), 5));
INSERT INTO t1(id, msg)
VALUES (142, REPEAT(PASSWORD(9), 5));
INSERT INTO t1(id, msg)
VALUES (143, REPEAT(PASSWORD(8), 5));
INSERT INTO t1(id, msg)
VALUES (144, REPEAT(PASSWORD(7), 5));
INSERT INTO t1(id, msg)
VALUES (145, REPEAT(PASSWORD(6), 5));
INSERT INTO t1(id, msg)
VALUES (146, REPEAT(PASSWORD(5), 5));
INSERT INTO t1(id, msg)
VALUES (147, REPEAT(PASSWORD(4), 5));
INSERT INTO t1(id, msg)
VALUES (148, REPEAT(PASSWORD(3), 5));
INSERT INTO t1(id, msg)
VALUES (149, REPEAT(PASSWORD(2), 5));
INSERT INTO t1(id, msg)
VALUES (150, REPEAT(PASSWORD(1), 5));
# Write file to make mysql-test-run.pl expect crash
call setcrash(1);
# Run the crashing query
COMMIT;
# Turn on reconnect
# Call script that will poll the server waiting for
# it to be back online again
SET GLOBAL innodb_compression_level = 4;
SET GLOBAL innodb_log_compressed_pages = OFF;
START TRANSACTION;
INSERT INTO t1(id, msg)
VALUES (151, REPEAT(PASSWORD(30), 5));
INSERT INTO t1(id, msg)
VALUES (152, REPEAT(PASSWORD(29), 5));
INSERT INTO t1(id, msg)
VALUES (153, REPEAT(PASSWORD(28), 5));
INSERT INTO t1(id, msg)
VALUES (154, REPEAT(PASSWORD(27), 5));
INSERT INTO t1(id, msg)
VALUES (155, REPEAT(PASSWORD(26), 5));
INSERT INTO t1(id, msg)
VALUES (156, REPEAT(PASSWORD(25), 5));
INSERT INTO t1(id, msg)
VALUES (157, REPEAT(PASSWORD(24), 5));
INSERT INTO t1(id, msg)
VALUES (158, REPEAT(PASSWORD(23), 5));
INSERT INTO t1(id, msg)
VALUES (159, REPEAT(PASSWORD(22), 5));
INSERT INTO t1(id, msg)
VALUES (160, REPEAT(PASSWORD(21), 5));
INSERT INTO t1(id, msg)
VALUES (161, REPEAT(PASSWORD(20), 5));
INSERT INTO t1(id, msg)
VALUES (162, REPEAT(PASSWORD(19), 5));
INSERT INTO t1(id, msg)
VALUES (163, REPEAT(PASSWORD(18), 5));
INSERT INTO t1(id, msg)
VALUES (164, REPEAT(PASSWORD(17), 5));
INSERT INTO t1(id, msg)
VALUES (165, REPEAT(PASSWORD(16), 5));
INSERT INTO t1(id, msg)
VALUES (166, REPEAT(PASSWORD(15), 5));
INSERT INTO t1(id, msg)
VALUES (167, REPEAT(PASSWORD(14), 5));
INSERT INTO t1(id, msg)
VALUES (168, REPEAT(PASSWORD(13), 5));
INSERT INTO t1(id, msg)
VALUES (169, REPEAT(PASSWORD(12), 5));
INSERT INTO t1(id, msg)
VALUES (170, REPEAT(PASSWORD(11), 5));
INSERT INTO t1(id, msg)
VALUES (171, REPEAT(PASSWORD(10), 5));
INSERT INTO t1(id, msg)
VALUES (172, REPEAT(PASSWORD(9), 5));
INSERT INTO t1(id, msg)
VALUES (173, REPEAT(PASSWORD(8), 5));
INSERT INTO t1(id, msg)
VALUES (174, REPEAT(PASSWORD(7), 5));
INSERT INTO t1(id, msg)
VALUES (175, REPEAT(PASSWORD(6), 5));
INSERT INTO t1(id, msg)
VALUES (176, REPEAT(PASSWORD(5), 5));
INSERT INTO t1(id, msg)
VALUES (177, REPEAT(PASSWORD(4), 5));
INSERT INTO t1(id, msg)
VALUES (178, REPEAT(PASSWORD(3), 5));
INSERT INTO t1(id, msg)
VALUES (179, REPEAT(PASSWORD(2), 5));
INSERT INTO t1(id, msg)
VALUES (180, REPEAT(PASSWORD(1), 5));
# Write file to make mysql-test-run.pl expect crash
call setcrash(1);
# Run the crashing query
COMMIT;
# Turn on reconnect
# Call script that will poll the server waiting for
# it to be back online again
SET GLOBAL innodb_compression_level = 3;
SET GLOBAL innodb_log_compressed_pages = OFF;
START TRANSACTION;
INSERT INTO t1(id, msg)
VALUES (181, REPEAT(PASSWORD(30), 5));
INSERT INTO t1(id, msg)
VALUES (182, REPEAT(PASSWORD(29), 5));
INSERT INTO t1(id, msg)
VALUES (183, REPEAT(PASSWORD(28), 5));
INSERT INTO t1(id, msg)
VALUES (184, REPEAT(PASSWORD(27), 5));
INSERT INTO t1(id, msg)
VALUES (185, REPEAT(PASSWORD(26), 5));
INSERT INTO t1(id, msg)
VALUES (186, REPEAT(PASSWORD(25), 5));
INSERT INTO t1(id, msg)
VALUES (187, REPEAT(PASSWORD(24), 5));
INSERT INTO t1(id, msg)
VALUES (188, REPEAT(PASSWORD(23), 5));
INSERT INTO t1(id, msg)
VALUES (189, REPEAT(PASSWORD(22), 5));
INSERT INTO t1(id, msg)
VALUES (190, REPEAT(PASSWORD(21), 5));
INSERT INTO t1(id, msg)
VALUES (191, REPEAT(PASSWORD(20), 5));
INSERT INTO t1(id, msg)
VALUES (192, REPEAT(PASSWORD(19), 5));
INSERT INTO t1(id, msg)
VALUES (193, REPEAT(PASSWORD(18), 5));
INSERT INTO t1(id, msg)
VALUES (194, REPEAT(PASSWORD(17), 5));
INSERT INTO t1(id, msg)
VALUES (195, REPEAT(PASSWORD(16), 5));
INSERT INTO t1(id, msg)
VALUES (196, REPEAT(PASSWORD(15), 5));
INSERT INTO t1(id, msg)
VALUES (197, REPEAT(PASSWORD(14), 5));
INSERT INTO t1(id, msg)
VALUES (198, REPEAT(PASSWORD(13), 5));
INSERT INTO t1(id, msg)
VALUES (199, REPEAT(PASSWORD(12), 5));
INSERT INTO t1(id, msg)
VALUES (200, REPEAT(PASSWORD(11), 5));
INSERT INTO t1(id, msg)
VALUES (201, REPEAT(PASSWORD(10), 5));
INSERT INTO t1(id, msg)
VALUES (202, REPEAT(PASSWORD(9), 5));
INSERT INTO t1(id, msg)
VALUES (203, REPEAT(PASSWORD(8), 5));
INSERT INTO t1(id, msg)
VALUES (204, REPEAT(PASSWORD(7), 5));
INSERT INTO t1(id, msg)
VALUES (205, REPEAT(PASSWORD(6), 5));
INSERT INTO t1(id, msg)
VALUES (206, REPEAT(PASSWORD(5), 5));
INSERT INTO t1(id, msg)
VALUES (207, REPEAT(PASSWORD(4), 5));
INSERT INTO t1(id, msg)
VALUES (208, REPEAT(PASSWORD(3), 5));
INSERT INTO t1(id, msg)
VALUES (209, REPEAT(PASSWORD(2), 5));
INSERT INTO t1(id, msg)
VALUES (210, REPEAT(PASSWORD(1), 5));
# Write file to make mysql-test-run.pl expect crash
call setcrash(1);
# Run the crashing query
COMMIT;
# Turn on reconnect
# Call script that will poll the server waiting for
# it to be back online again
SET GLOBAL innodb_compression_level = 2;
SET GLOBAL innodb_log_compressed_pages = OFF;
START TRANSACTION;
INSERT INTO t1(id, msg)
VALUES (211, REPEAT(PASSWORD(30), 5));
INSERT INTO t1(id, msg)
VALUES (212, REPEAT(PASSWORD(29), 5));
INSERT INTO t1(id, msg)
VALUES (213, REPEAT(PASSWORD(28), 5));
INSERT INTO t1(id, msg)
VALUES (214, REPEAT(PASSWORD(27), 5));
INSERT INTO t1(id, msg)
VALUES (215, REPEAT(PASSWORD(26), 5));
INSERT INTO t1(id, msg)
VALUES (216, REPEAT(PASSWORD(25), 5));
INSERT INTO t1(id, msg)
VALUES (217, REPEAT(PASSWORD(24), 5));
INSERT INTO t1(id, msg)
VALUES (218, REPEAT(PASSWORD(23), 5));
INSERT INTO t1(id, msg)
VALUES (219, REPEAT(PASSWORD(22), 5));
INSERT INTO t1(id, msg)
VALUES (220, REPEAT(PASSWORD(21), 5));
INSERT INTO t1(id, msg)
VALUES (221, REPEAT(PASSWORD(20), 5));
INSERT INTO t1(id, msg)
VALUES (222, REPEAT(PASSWORD(19), 5));
INSERT INTO t1(id, msg)
VALUES (223, REPEAT(PASSWORD(18), 5));
INSERT INTO t1(id, msg)
VALUES (224, REPEAT(PASSWORD(17), 5));
INSERT INTO t1(id, msg)
VALUES (225, REPEAT(PASSWORD(16), 5));
INSERT INTO t1(id, msg)
VALUES (226, REPEAT(PASSWORD(15), 5));
INSERT INTO t1(id, msg)
VALUES (227, REPEAT(PASSWORD(14), 5));
INSERT INTO t1(id, msg)
VALUES (228, REPEAT(PASSWORD(13), 5));
INSERT INTO t1(id, msg)
VALUES (229, REPEAT(PASSWORD(12), 5));
INSERT INTO t1(id, msg)
VALUES (230, REPEAT(PASSWORD(11), 5));
INSERT INTO t1(id, msg)
VALUES (231, REPEAT(PASSWORD(10), 5));
INSERT INTO t1(id, msg)
VALUES (232, REPEAT(PASSWORD(9), 5));
INSERT INTO t1(id, msg)
VALUES (233, REPEAT(PASSWORD(8), 5));
INSERT INTO t1(id, msg)
VALUES (234, REPEAT(PASSWORD(7), 5));
INSERT INTO t1(id, msg)
VALUES (235, REPEAT(PASSWORD(6), 5));
INSERT INTO t1(id, msg)
VALUES (236, REPEAT(PASSWORD(5), 5));
INSERT INTO t1(id, msg)
VALUES (237, REPEAT(PASSWORD(4), 5));
INSERT INTO t1(id, msg)
VALUES (238, REPEAT(PASSWORD(3), 5));
INSERT INTO t1(id, msg)
VALUES (239, REPEAT(PASSWORD(2), 5));
INSERT INTO t1(id, msg)
VALUES (240, REPEAT(PASSWORD(1), 5));
# Write file to make mysql-test-run.pl expect crash
call setcrash(1);
# Run the crashing query
COMMIT;
# Turn on reconnect
# Call script that will poll the server waiting for
# it to be back online again
SET GLOBAL innodb_compression_level = 1;
SET GLOBAL innodb_log_compressed_pages = OFF;
START TRANSACTION;
INSERT INTO t1(id, msg)
VALUES (241, REPEAT(PASSWORD(30), 5));
INSERT INTO t1(id, msg)
VALUES (242, REPEAT(PASSWORD(29), 5));
INSERT INTO t1(id, msg)
VALUES (243, REPEAT(PASSWORD(28), 5));
INSERT INTO t1(id, msg)
VALUES (244, REPEAT(PASSWORD(27), 5));
INSERT INTO t1(id, msg)
VALUES (245, REPEAT(PASSWORD(26), 5));
INSERT INTO t1(id, msg)
VALUES (246, REPEAT(PASSWORD(25), 5));
INSERT INTO t1(id, msg)
VALUES (247, REPEAT(PASSWORD(24), 5));
INSERT INTO t1(id, msg)
VALUES (248, REPEAT(PASSWORD(23), 5));
INSERT INTO t1(id, msg)
VALUES (249, REPEAT(PASSWORD(22), 5));
INSERT INTO t1(id, msg)
VALUES (250, REPEAT(PASSWORD(21), 5));
INSERT INTO t1(id, msg)
VALUES (251, REPEAT(PASSWORD(20), 5));
INSERT INTO t1(id, msg)
VALUES (252, REPEAT(PASSWORD(19), 5));
INSERT INTO t1(id, msg)
VALUES (253, REPEAT(PASSWORD(18), 5));
INSERT INTO t1(id, msg)
VALUES (254, REPEAT(PASSWORD(17), 5));
INSERT INTO t1(id, msg)
VALUES (255, REPEAT(PASSWORD(16), 5));
INSERT INTO t1(id, msg)
VALUES (256, REPEAT(PASSWORD(15), 5));
INSERT INTO t1(id, msg)
VALUES (257, REPEAT(PASSWORD(14), 5));
INSERT INTO t1(id, msg)
VALUES (258, REPEAT(PASSWORD(13), 5));
INSERT INTO t1(id, msg)
VALUES (259, REPEAT(PASSWORD(12), 5));
INSERT INTO t1(id, msg)
VALUES (260, REPEAT(PASSWORD(11), 5));
INSERT INTO t1(id, msg)
VALUES (261, REPEAT(PASSWORD(10), 5));
INSERT INTO t1(id, msg)
VALUES (262, REPEAT(PASSWORD(9), 5));
INSERT INTO t1(id, msg)
VALUES (263, REPEAT(PASSWORD(8), 5));
INSERT INTO t1(id, msg)
VALUES (264, REPEAT(PASSWORD(7), 5));
INSERT INTO t1(id, msg)
VALUES (265, REPEAT(PASSWORD(6), 5));
INSERT INTO t1(id, msg)
VALUES (266, REPEAT(PASSWORD(5), 5));
INSERT INTO t1(id, msg)
VALUES (267, REPEAT(PASSWORD(4), 5));
INSERT INTO t1(id, msg)
VALUES (268, REPEAT(PASSWORD(3), 5));
INSERT INTO t1(id, msg)
VALUES (269, REPEAT(PASSWORD(2), 5));
INSERT INTO t1(id, msg)
VALUES (270, REPEAT(PASSWORD(1), 5));
# Write file to make mysql-test-run.pl expect crash
call setcrash(1);
# Run the crashing query
COMMIT;
# Turn on reconnect
# Call script that will poll the server waiting for
# it to be back online again
SELECT * FROM t1;
id	msg
TRUNCATE TABLE t1;
DROP TABLE t1;
DROP PROCEDURE setcrash;
SET SESSION DEBUG_DBUG= 'RESET';
